var wxmcp_url=$$.online?"https://mcp.ddky.com/weixin/rest.htm":"http://192.168.86.72:8080/weixin/rest.htm",thisPageApp={user:"",bundUrl:"",mbcenterUrl:"",init:function(){this.user=$$.cookie("user"),$$.getUserId()?($(".nologin").hide(),$(".usertel").show(),$(".userother").show(),$(".my-footer").addClass("hasuser").find(".hasUserli").show(),this.getMemberInfo(),this.getwxName(),this.orderNum(),this.waitPayNum()):($(".nologin").show(),$(".usertel").hide(),$(".userother").hide(),$(".membercenterBox").hide()),this.showPage(),$$.toggle_nav(),$(".waitpay").click($.proxy(this.waitPay,this)),$(".currentorder").click($.proxy(this.currentOrder,this)),$(".waitcomment").click($.proxy(this.waitComment,this)),$(".allorder").click($.proxy(this.allOrder,this)),$(".ddsl").click($.proxy(this.ddgifts,this)),$(".myyouhui").click($.proxy(this.myYouHui,this)),$(".dizhiguanli").click($.proxy(this.diZhiGuanLi,this)),$(".myshoucang").click($.proxy(this.myShouCang,this)),$(".order").click($.proxy(this.order,this)),$(".icon-mycoin").click($.proxy(this.mycoin,this)),$(".unbundling").click($.proxy(this.unbundingwx,this)),$(".bundling").click($.proxy(this.bundingwx,this)),$(".membercenterBox").click($.proxy(this.tomembercenter,this)),$(".toquit").click($.proxy(this.quit,this)),$(".preSaleOrderList").click($.proxy(this.preSaleOrderList,this)),$(".nologin").on("click",function(){window.location.href="login.html"})},quit:function(){["user","cityName","shopInfo","LNG","LAT","orderInfo","address"].forEach(function(t){$$.cookie.remove(t)}),$$.online?window.location.href=$$.isPre?"http://prem.ddky.com/":"https://m.ddky.com/":window.location.href="http://192.168.89.47:8088/"},showPage:function(){$$.getUserId()&&$(".mycoin").show(),"qingqu"==$$.getQueryString("from")?$(".login-btn").attr("href","login.html?from=qingqu"):$(".login-btn").attr("href","login.html"),this.waitNum()},getMemberInfo:function(){var _this=this,params=new $$.DMap;params.put("method","account"),params.put("userId",$$.getUserId());var infoUrl=$$.getRequestURL($$.urls.url_user,params);$.ajax({type:"get",url:infoUrl,cache:!0,dataType:"jsonp",success:function(json){if(0!=json.code)return void $$.alert({width:"260",height:"120",msg:json.msg});var oInfo=json.data;_this.mbcenterUrl=oInfo.url;var userinfo=eval("("+_this.user+")");oInfo.companyUrl&&null!=oInfo.companyUrl?$(".usertel").html(userinfo.tel+'<img src="'+oInfo.companyUrl+'" />'):$(".usertel").html(userinfo.tel),$(".member_rank").text(oInfo.rank),$(".member_Money").text("叮当币 : "+oInfo.coin),$(".userIconBox img").attr("src",oInfo.topUrl)}})},waitPay:function(){if(0==this.user)return $$.alert({width:"260",height:"120",msg:"请先登录",classVal:"btn-login"}),void $(".btn-login").click(function(){toLogin()});window.location.href="wait-pay.html?from=dangqian"},waitPayNum:function(){var t={userId:$$.getUserId()},e=$$.urls.url_order,i=new $$.DMap;i.put("method","ddsy.order.count.currentpaylist");var o=$.cookie("yhSign");o&&"yh365"==o?i.put("param",'{"userId":"'+t.userId+'","orderSource":35}'):i.put("param",'{"userId":"'+t.userId+'"}');var n=$$.getRequestURL(e,i);$.ajax({type:"get",url:n,cache:!0,dataType:"jsonp",success:function(t){if(0!=t.code)return void $$.alert({width:"260",height:"120",msg:t.msg});0==t.data||null==t.data?$(".pay-num").hide():($(".pay-num").show(),$(".pay-num").text(t.data))}})},currentOrder:function(){this.sureLogin()&&(window.location.href="order-goods.html?from=dangqian")},orderNum:function(){var t=$$.urls.url_order,e=new $$.DMap;e.put("method","ddsy.order.count.currentlist");var i=$.cookie("yhSign");i&&"yh365"==i?e.put("param",'{"userId":"'+$$.getUserId()+'","pageSize":10,"pageNo":1,"orderSource":35}'):e.put("param",'{"userId":"'+$$.getUserId()+'","pageSize":10,"pageNo":1}');var o=$$.getRequestURL(t,e);$$.showLoading(),$.ajax({type:"get",url:o,cache:!0,dataType:"jsonp",success:function(t){$$.hideLoading(),0==t.data||null==t.data?$(".dq-num").hide():($(".dq-num").show(),$(".dq-num").text(t.data))}})},allOrder:function(){this.sureLogin()&&(window.location.href="order-goods.html")},ddgifts:function(){window.location.href=$$.online?"http://m.ddky.com/app/ddky/gift/index.html":"http://192.168.89.47:8088/app/ddky/gift/index.html"},myShouCang:function(){this.sureLogin()&&(window.location.href="wodeshouchang.html")},mycoin:function(){this.sureLogin()&&(window.location.href=$$.online?"http://m.ddky.com/app/ddky/zhyf/ddbshop.html":"http://192.168.89.47:8088/app/ddky/zhyf/ddbshop.html")},shouCangNum:function(){var t=$$.urls.url_home,e=new $$.DMap;e.put("method","countFavorite"),e.put("userId",$$.getUserId());var i=$$.getRequestURL(t,e);$$.showLoading(),$.ajax({type:"get",url:i,cache:!0,dataType:"jsonp",success:function(t){$$.hideLoading(),0==t.data||null==t.data?$(".sc-num").hide():($(".sc-num").show(),$(".sc-num").text(t.data))}})},myYouHui:function(){this.sureLogin()&&(window.location.href="coupons.html")},order:function(){this.sureLogin()&&(window.location.href="")},diZhiGuanLi:function(){this.sureLogin()&&(window.location.href="add-address.html?from=my-dingdangdenglu")},waitComment:function(){this.sureLogin()&&(window.location.href="wait-comment.html?from=dangqian")},preSaleOrderList:function(){this.sureLogin()&&(window.location.href=window.location.origin+"/app/ddky/presale/orderList.html")},waitNum:function(){var t=$$.urls.url_order,e=new $$.DMap;e.put("method","ddsy.order.count.uncommentedlist"),e.put("userId",$$.getUserId());var i=$$.getRequestURL(t,e);$.ajax({type:"get",url:i,cache:!0,dataType:"jsonp",success:function(t){t.data>0&&$(".comm-num").text(t.data).show()}})},sureLogin:function(){return!!this.user||($$.alert({width:"260",height:"120",msg:"请先登录",classVal:"btn-login"}),$(".btn-login").click(function(){toLogin()}),!1)},getwxName:function(){var t=this,e=new $$.DMap;e.put("method","ddky.user.weixin.bind.state.check"),e.put("userId",$$.getUserId());var i=$$.getRequestURL(wxmcp_url,e);$.ajax({type:"get",url:i,cache:!0,dataType:"jsonp",success:function(e){if(0!=e.code)return void $$.alert({width:"260",height:"120",msg:e.msg});1==e.result.isBind?($("#userName").text(e.result.nickName),$(".unbundling").show(),$(".bundling").hide()):($("#userName").text("未绑定"),$(".unbundling").hide(),$(".bundling").show(),t.bundUrl=e.result.bindUrl)}})},unbundingwx:function(){var t=new $$.DMap;t.put("method","ddky.user.weixin.unbind"),t.put("userId",$$.getUserId());var e=$$.getRequestURL(wxmcp_url,t);$.ajax({type:"get",url:e,cache:!0,dataType:"jsonp",success:function(t){if(0!=t.code)return void $$.alert({width:"260",height:"120",msg:t.msg});sessionStorage.removeItem("userId"),sessionStorage.clear(),$.cookie("user","",{path:"/",domain:domain_way}),$.cookie("address","",{domain:domain_way,path:"/"}),$.cookie("orderInfo","",{domain:domain_way,path:"/"}),$$.cookie.empty(),window.location.reload()}})},bundingwx:function(){if(!$$.isWX)return void $$.alert({width:"260",height:"120",msg:"请在微信绑定"});window.location.href=this.bundUrl},tomembercenter:function(){this.mbcenterUrl&&(window.location.href=this.mbcenterUrl)}};$(function(){var t=$.cookie("yhSign"),e=$$.getQueryString("enc")||"",i=$$.getQueryString("act")||"";e?i&&"mydlBindWx"==i&&thisPageApp.init():thisPageApp.init(),t&&"yh365"==t&&($(".footer-nav li").hide(),$(".hasUserli").show())});